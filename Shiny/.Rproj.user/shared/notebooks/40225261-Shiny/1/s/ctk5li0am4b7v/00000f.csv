"0",""
"0","generateCoralPlot <- function(region, selected_year, weightedmeans, om_spp, s_spp, rm_spp, species_list) {"
"0","  selected_year <- as.double(selected_year)"
"0","  "
"0","  a <- weightedmeans %>% "
"0","      dplyr::select(REGION, YEAR, SPECIES_CD, avDen, CV, SE) %>% "
"0","      dplyr::rename(""SE_avDen"" = SE)"
"0",""
"0","  b <- om_spp %>% "
"0","    dplyr::mutate(SPECIES_CD = SPECIES_NAME) %>% "
"0","    dplyr::select(REGION, YEAR, SPECIES_CD, avMort, SE) %>% "
"0","    dplyr::rename(""avMortOld"" = avMort,"
"0","                  ""SE_avMortOld"" = SE)"
"0","  c <- s_spp %>% "
"0","    dplyr::mutate(SPECIES_CD = SPECIES_NAME) %>% "
"0","    dplyr::select(REGION, YEAR, SPECIES_CD, avMaxdiam, SE_maxdiam)"
"0","  "
"0","  d <- rm_spp %>% "
"0","    dplyr::mutate(SPECIES_CD = SPECIES_NAME) %>% "
"0","    dplyr::select(REGION, YEAR, SPECIES_CD, avMort, SE) %>% "
"0","    dplyr::rename(""avMortRec"" = avMort,"
"0","                  ""SE_avMortRec"" = SE)"
"0","  "
"0","  newdat <- a %>% "
"0","    dplyr::left_join(., b) %>% "
"0","    dplyr::left_join(., c) %>% "
"0","    dplyr::left_join(., d) %>%"
"0","    arrange(desc(avDen)) %>%"
"0","    dplyr::filter(CV < 1) %>%"
"0","    mutate(REGION = region)"
"0","  "
"0"," "
"0","if (!is.null(species_list) && !is.null(selected_year)) {"
"0","  selected_year <- as.numeric(selected_year)"
"0","  newdat <- newdat %>%"
"0","    dplyr::filter(SPECIES_CD %in% species_list & YEAR == selected_year)"
"0","}"
"0",""
"0","   print(newdat)"
"0",""
"0","  spp_levels <- newdat %>%"
"0","    dplyr::arrange(avDen)"
"0",""
"0","  spp_levels <- spp_levels$SPECIES_CD"
"0",""
"0","  newdat <- newdat %>%"
"0","    dplyr::mutate(SPECIES_CD = factor(SPECIES_CD, levels = spp_levels))"
"0","  "
"0",""
"0","dens_plot <- ggplot(data = newdat, aes(x = avDen, y = SPECIES_CD)) +"
"0","  geom_point(stat = ""identity"", size = 3.75) +"
"0","  geom_errorbar(aes(xmin = avDen - SE_avDen, xmax = avDen + SE_avDen, y = SPECIES_CD), width = 0, color = ""black"") +"
"0","  labs(x = expression(Density ~ (corals/m^{2})), y = """") +"
"0","  theme_light() +"
"0","  theme_Publication(base_size = 20) +"
"0","  theme(axis.text.y = element_text(face = ""italic""))"
"0",""
"0","om_plot <- ggplot(data = newdat, aes(x = avMortOld, y = SPECIES_CD)) +"
"0","  geom_point(stat = ""identity"", size = 3.75) +"
"0","  geom_errorbar(aes(xmin = avMortOld - SE_avMortOld, xmax = avMortOld + SE_avMortOld, y = SPECIES_CD), width = 0, color = ""black"") +"
"0","  labs(x = expression(Old ~ mortality ~ (""%"")), y = """") +"
"0","  theme_light() +"
"0","  theme_Publication(base_size = 20) +"
"0","  theme(axis.text.y = element_blank(), axis.title.y = element_blank())"
"0",""
"0","rm_plot <- ggplot(data = newdat, aes(x = avMortRec, y = SPECIES_CD)) +"
"0","  geom_point(stat = ""identity"", size = 3.75) +"
"0","  geom_errorbar(aes(xmin = avMortRec - SE_avMortRec, xmax = avMortRec + SE_avMortRec, y = SPECIES_CD), width = 0, color = ""black"") +"
"0","  labs(x = expression(Recent ~ mortality ~ (""%"")), y = """") +"
"0","  theme_light() +"
"0","  theme_Publication(base_size = 20) +"
"0","  theme(axis.text.y = element_blank(), axis.title.y = element_blank())"
"0",""
"0","size_plot <- ggplot(data = newdat, aes(x = avMaxdiam, y = SPECIES_CD)) +"
"0","  geom_point(stat = ""identity"", size = 3.75) +"
"0","  geom_errorbar(aes(xmin = avMaxdiam - SE_maxdiam, xmax = avMaxdiam + SE_maxdiam, y = SPECIES_CD), width = 0, color = ""black"") +"
"0","  labs(x = expression(Maximum ~ diameter ~ (cm)), y = """") +"
"0","  theme_light() +"
"0","  theme_Publication(base_size = 20) +"
"0","  theme(axis.text.y = element_blank(), axis.title.y = element_blank())"
"0",""
"0",""
"0","combined_plot <- egg::ggarrange(dens_plot, om_plot, rm_plot, size_plot, ncol = 4)  # You can adjust ncol as needed"
"0",""
"0","  # Print or save the combined plot"
"0","  print(combined_plot)"
"0",""
"0",""
"0","# "
"0","# dens_plot <- plot_ly(data = newdat, x = ~avDen, y = ~SPECIES_CD, type = ""scatter"", mode = ""markers"") %>%"
"0","#   #add_errorbars(x = ~avDen, y = ~SPECIES_CD, xmin = ~avDen - SE_avDen, xmax = ~avDen + SE_avDen) %>%"
"0","#   layout(xaxis = list(title = expression(Density ~ (corals/m^{2})), yaxis = list(title = """")))"
"0","# "
"0","# om_plot <- plot_ly(data = newdat, x = ~avMortOld, y = ~SPECIES_CD, type = ""scatter"", mode = ""markers"") %>%"
"0","#   #add_errorbars(x = ~avMortOld, y = ~SPECIES_CD, xmin = ~avMortOld - SE_avMortOld, xmax = ~avMortOld + SE_avMortOld) %>%"
"0","#   layout(xaxis = list(title = expression(Old ~ mortality ~ (""%"")), yaxis = list(title = """")))"
"0","# "
"0","# rm_plot <- plot_ly(data = newdat, x = ~avMortRec, y = ~SPECIES_CD, type = ""scatter"", mode = ""markers"") %>%"
"0","#   #add_errorbars(x = ~avMortRec, y = ~SPECIES_CD, xmin = ~avMortRec - SE_avMortRec, xmax = ~avMortRec + SE_avMortRec) %>%"
"0","#   layout(xaxis = list(title = expression(Recent ~ mortality ~ (""%"")), yaxis = list(title = """")))"
"0","# "
"0","# "
"0","# size_plot <- plot_ly(data = newdat, x = ~avMaxdiam, y = ~SPECIES_CD, type = ""scatter"", mode = ""markers"") %>%"
"0","#   #add_errorbars(x = ~avMaxdiam, y = ~SPECIES_CD, xmin = ~avMaxdiam - SE_maxdiam, xmax = ~avMaxdiam + SE_maxdiam) %>%"
"0","#   layout(xaxis = list(title = expression(Maximum ~ diameter ~ (cm)), yaxis = list(title = """")))"
"0","# "
"0","#   subplot(dens_plot, om_plot, rm_plot, size_plot, nrows = 2)  "
"0",""
"0","  return(NULL)"
"0",""
"0","}"
"0",""
