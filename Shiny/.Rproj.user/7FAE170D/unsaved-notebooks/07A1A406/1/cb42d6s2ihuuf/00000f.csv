"0",""
"0",""
"0","#Create Plot"
"0","make_size_plot <- function(x, y = ""length"") {"
"0","  "
"0","  if (y == ""size"") {"
"0","    domain_estimates = x$size_domain_est"
"0","    demos = x$size_3d_demos"
"0","    name = ""Binned Surface Area in""~cm^3"
"0","  }"
"0","  "
"0","  if (y == ""length"") {"
"0","    domain_estimates = x$length_freq_domain_est"
"0","    demos = x$length_demos"
"0","    name = ""Length (cm)"""
"0","  }"
"0","  "
"0","  uniq_s <- unique(domain_estimates$SPECIES_CD) "
"0","  "
"0","  for (i in uniq_s) {"
"0","    "
"0","    domain_sub = subset(domain_estimates, SPECIES_CD == i)"
"0","    demos_sub = subset(demos, SPECIES_CD == i)"
"0","    n_bins = max(demos_sub$n_bins)"
"0","    text_size = 11"
"0","    angle = dplyr::if_else(n_bins > 6 | y == ""size"", 45, 0)"
"0","    hjust = dplyr::if_else(angle == 45, 1, 0.5)"
"0","    min = min(demos_sub$min)"
"0","    bin_width = min(demos_sub$bin_width)"
"0","    small = dplyr::if_else(n_bins > 4, 0, 1)"
"0","    "
"0","    num_vec = seq_len(max(domain_sub$bin_num))"
"0","    "
"0","    x$bin_low = dplyr::if_else(x$bin_num == 1, 4, round(x$min + (x$bin_width * (x$bin_num-1))+2,2))"
"0","    "
"0","    x$bin_high = round(x$bin_width +x$min + (x$bin_width * (x$bin_num-1))+1,2)"
"0","    "
"0","    lab_vec = paste(x$bin_low, x$bin_high, sep = ""-"")"
"0","    "
"0","    lab_vec = paste("
"0","      format("
"0","        x = dplyr::if_else(num_vec == 1, 4, round(min + (bin_width * (num_vec-1))+2,small)),"
"0","        nsmall = small"
"0","      ),"
"0","      #""-"","
"0","      format("
"0","        x = round(bin_width + min + (bin_width * (num_vec-1))+1,small),"
"0","        nsmall = small"
"0","      ),"
"0","      sep = ""-"""
"0","    )"
"0","    "
"0","    "
"0","    "
"0","    print("
"0","      ggplot(data = domain_sub, aes(x = as.integer(bin_num), y = length_freq_domain, "
"0","                                    fill = YEAR)) +"
"0","        geom_bar(stat=""identity"", position = ""dodge2"", width = .9, color=""black"", size=.5) +"
"0","        theme_Publication(base_size = 20) +"
"0","        #    facet_wrap(~facet_label, nrow=4, scales = ""free"") +"
"0","        labs("
"0","          y = ""Frequency"") +"
"0","        scale_x_continuous(name = name, "
"0","                           breaks = seq_along(lab_vec),"
"0","                           labels = lab_vec) +"
"0","        ggtitle(unique(domain_sub$SPECIES_NAME)) +"
"0","        theme(axis.text.x = element_text(size = text_size, angle = angle, "
"0","                                         hjust = hjust),"
"0","              legend.key = element_rect(colour = NA),"
"0","              legend.position = ""bottom"","
"0","              legend.direction = ""horizontal"","
"0","              legend.key.size= unit(0.5, ""cm""),"
"0","              legend.margin = margin(0,0,0,0, ""cm"")"
"0","              #,"
"0","              #legend.title = element_text(face=""italic"")"
"0","        ) +"
"0","        scale_fill_manual(values=c('steelblue2','springgreen3','gold1'))"
"0","    )"
"0","    "
"0","  } "
"0","}"
"0",""
"0",""
